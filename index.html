<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>AI Emotion-Friendly Tutor</title>

<!-- Pastel Theme -->
<style>
    body {
        font-family: Arial, sans-serif;
        background: #e7f5ff; /* pastel light blue */
        text-align: center;
        padding: 20px;
        color: #004e64;
    }
    h1 {
        color: #005f73;
    }
    button {
        background: #8bd3dd;
        color: white;
        padding: 12px 24px;
        border: none;
        border-radius: 12px;
        font-size: 16px;
        cursor: pointer;
        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }
    button:hover {
        background: #6cc5cf;
    }
    #webcam-container canvas {
        margin-top: 20px;
        border-radius: 20px;
        box-shadow: 0 6px 14px rgba(0,0,0,0.18);
    }
    #label-container div {
        background: white;
        border-radius: 10px;
        padding: 10px;
        margin: 10px auto;
        max-width: 300px;
        box-shadow: 0 3px 8px rgba(0,0,0,0.12);
        font-size: 17px;
    }
    #statusMessage {
        margin-top: 20px;
        font-size: 22px;
        font-weight: bold;
        color: #005f73;
    }
</style>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>
</head>

<body>

<h1>AI Emotion-Friendly Tutor üåü</h1>
<p>This tool detects whether you're <b>Engaged</b>, <b>Confused</b>, or <b>Focused</b> using a Teachable Machine model.</p>

<button onclick="start()">Start</button>

<div id="webcam-container"></div>
<div id="label-container"></div>
<div id="statusMessage">Waiting to start‚Ä¶</div>

<script>
// MODEL FOLDER
const URL = "./my_model/";

let model, webcam, labelContainer, maxPredictions;

async function start() {
    document.getElementById("statusMessage").innerHTML = "Loading model‚Ä¶ ‚è≥";

    // Load model
    model = await tmImage.load(URL + "model.json", URL + "metadata.json");
    maxPredictions = model.getTotalClasses();

    // Webcam
    webcam = new tmImage.Webcam(250, 250, true);
    await webcam.setup();
    await webcam.play();
    window.requestAnimationFrame(loop);

    document.getElementById("webcam-container").appendChild(webcam.canvas);

    // Labels
    labelContainer = document.getElementById("label-container");
    labelContainer.innerHTML = "";
    for (let i = 0; i < maxPredictions; i++) {
        labelContainer.appendChild(document.createElement("div"));
    }

    document.getElementById("statusMessage").innerHTML = "Model Loaded! üòä";
}

async function loop() {
    webcam.update();
    await predict();
    window.requestAnimationFrame(loop);
}

async function predict() {
    const prediction = await model.predict(webcam.canvas);

    let topClass = "";
    let highest = 0;

    for (let i = 0; i < prediction.length; i++) {
        const p = prediction[i];
        labelContainer.childNodes[i].innerHTML =
            `${p.className}: ${p.probability.toFixed(2)}`;

        if (p.probability > highest) {
            highest = p.probability;
            topClass = p.className;
        }
    }

    // EMOJI + MESSAGE SYSTEM
    let message = "";

    if (topClass === "Engaged") {
        message = "üòÄ You're engaged and ready to learn!";
    } 
    else if (topClass === "Confused") {
        message = "ü§î You look confused ‚Äî maybe try reviewing the material?";
    } 
    else if (topClass === "Focused") {
        message = "üß† You're focused! Keep up the great work.";
    }

    document.getElementById("statusMessage").innerHTML = message;
}
</script>

</body>
</html>
